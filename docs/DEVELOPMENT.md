# 開発ルール

## TypeScript

- import パスには `.js` 拡張子を付ける（例: `import { x } from './core.js'`）
  - `tsc` は import パスを書き換えないため、ESM で実行時に解決できるよう明示する必要がある
- ランタイム依存ライブラリは追加しない（devDependencies のみ許可）

## package.json

- `exports` フィールドで `types` は `default` より前に記述する
- `files` フィールドでビルド成果物のみを npm publish 対象にする

## データ設計

- 日付は JST の `YYYY-MM-DD` 形式で扱う
- 祝日判定用データ（`light`）と祝日名データ（`full`）はモジュールを分離し、サブパスエクスポートで提供する
- 検索は Map/Set による O(1) ルックアップを使用する

## ビルド方法

```bash
npm run build   # tsc でコンパイル（dist/ に出力）
```

- ビルドツールは `tsc` のみ。バンドラーは使用しない
- 出力形式は ESM のみ（CJS 非対応）
- 出力先は `dist/`

## コミットメッセージ

### 形式

```
<prefix>: <要約>

<本文（任意）>
```

### prefix 一覧

| prefix | 用途 |
|---|---|
| `feat` | 新機能の追加 |
| `fix` | バグの修正 |
| `docs` | ドキュメントの変更 |
| `refactor` | 機能変更を伴わないコードの改善 |
| `test` | テストの追加・修正 |
| `chore` | ビルド設定・CI・依存更新など |

### ルール

- 要約は簡潔に、何を変更したかを書く
- 本文には変更の理由（WHY）を書く。差分を見れば分かる内容（WHAT）だけでは不十分
  - 例: 「Map に変更した」ではなく「線形探索がボトルネックだったため Map に変更した」
- 要約・本文は日本語で書く（prefix は英語のまま使用する）

## ブランチ戦略

GitHub Flow を採用する。

- `main` — 常にリリース可能な状態を維持する
- 作業ごとにブランチを切り、PR で `main` にマージする

### ブランチの命名規則

```
<prefix>/<変更内容をケバブケースで簡潔に>
```

| prefix | 用途 | 例 |
|---|---|---|
| `feature/` | 新機能の追加 | `feature/add-holiday-name-api` |
| `fix/` | バグの修正 | `fix/timezone-handling` |
| `chore/` | ドキュメント・リファクタ・CI・依存更新など | `chore/update-holiday-data` |

### Issue

- Bug Report と Feature Request の 2 種類のテンプレートを使用する
- タイトルは内容を簡潔に書く

### Pull Request

- タイトルはコミットメッセージと同じ形式（`<prefix>: <要約>`）
- 本文にはテンプレートに従い、変更の概要・関連 Issue・テスト方法を記載する
- `main` への直接プッシュは禁止し、PR を必須とする
- マージ方法は Squash merge を使用する
- Issue を閉じる場合は本文に `closes #番号` を記載する

### バージョニング

[Semantic Versioning](https://semver.org/) に従う。

| 変更内容 | バージョン | 例 |
|---|---|---|
| 破壊的変更 | メジャー | `1.0.0` → `2.0.0` |
| 機能追加（後方互換） | マイナー | `1.0.0` → `1.1.0` |
| バグ修正 | パッチ | `1.0.0` → `1.0.1` |

### リリース

- `main` から直接 npm publish し、Git タグ（`v1.2.0`）を打つ
- 旧メジャーバージョンのメンテナンスブランチは、必要になった時点で検討する
